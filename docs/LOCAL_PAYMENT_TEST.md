# 로컬 결제 테스트 가이드

## 1. 토스페이먼츠 테스트 키 발급 (5분)

### 1.1 회원가입
1. https://developers.tosspayments.com/ 접속
2. 우측 상단 "시작하기" 클릭
3. 이메일로 회원가입 또는 소셜 로그인

### 1.2 API 키 발급
1. 로그인 후 [개발자센터](https://developers.tosspayments.com/my/api-keys) 접속
2. "내 개발정보" → "API 키" 메뉴
3. **테스트 모드 키** 확인:
   - 클라이언트 키: `test_ck_...`
   - 시크릿 키: `test_sk_...`

### 1.3 환경 변수 설정
`.env.local` 파일에 키 추가:

```bash
# 토스페이먼츠 테스트 키
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TOSS_SECRET_KEY=test_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 앱 URL (로컬 개발)
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

---

## 2. 샘플 데이터 시딩 (5분)

### 2.1 Supabase SQL Editor에서 실행
1. Supabase 대시보드 접속: https://supabase.com/dashboard
2. 프로젝트 선택 → 좌측 "SQL Editor" 메뉴
3. "New query" 클릭
4. `supabase/seed-data.sql` 파일 내용 전체 복사
5. 붙여넣기 후 "Run" 버튼 클릭

### 2.2 시딩된 데이터 확인
- **카테고리 5개**: 아우터, 상의, 하의, 원피스, 액세서리
- **상품 20개**: 각 카테고리별 4개씩
- **촬영룩 5개**: 봄/여름/가을/겨울/데이트룩
- **테스트 쿠폰 3개**:
  - `WELCOME10`: 10,000원 할인 (신규 회원)
  - `SPRING20`: 20% 할인 (봄 시즌)
  - `FREESHIP`: 배송비 무료

---

## 3. 로컬 서버 실행 (1분)

```bash
cd /home/user/webapp
npm run dev
```

브라우저에서 http://localhost:3000 접속

---

## 4. 결제 테스트 시나리오 (10분)

### 4.1 상품 주문 테스트

#### Step 1: 상품 선택
1. 홈페이지 → "판매상품" 메뉴 클릭
2. 마음에 드는 상품 선택 (예: "캐시미어 코트")
3. 사이즈 선택 (M), 색상 선택 (블랙)
4. 수량 2개
5. "장바구니 담기" 클릭

#### Step 2: 쿠폰 적용
1. 우측 상단 장바구니 아이콘 클릭
2. 쿠폰 입력란에 `WELCOME10` 입력
3. "적용" 버튼 → 10,000원 할인 확인

#### Step 3: 결제 진행
1. "결제하기" 버튼 클릭
2. 토스페이먼츠 결제창 열림 ✅
3. **테스트 카드 정보 입력**:
   ```
   카드번호: 4242-4242-4242-4242
   유효기간: 12/25 (미래 날짜)
   CVC: 123
   비밀번호 앞 2자리: 12
   ```
4. "결제하기" 버튼 클릭

#### Step 4: 결제 완료
1. `/payment/success` 페이지로 리다이렉트 ✅
2. 주문 번호 표시 (예: `ORDER-1234567890`)
3. 주문 상세 정보 확인
4. "주문 내역 보기" 클릭 → 마이페이지 주문 목록

---

### 4.2 Admin 주문 관리 테스트

#### Step 1: Admin 로그인
1. `/admin/login` 접속
2. 관리자 계정으로 로그인

#### Step 2: 주문 확인
1. Admin 대시보드 → "오늘 주문" 카드 클릭
2. 또는 좌측 메뉴 "주문 관리" 클릭
3. 방금 생성된 주문 확인 ✅
   - 주문 번호
   - 고객 이름
   - 결제 금액
   - 상태: "결제완료 (pending)"

#### Step 3: 주문 상태 변경
1. 주문 카드에서 "상태 변경" 버튼 클릭
2. 드롭다운에서 "상품준비중 (processing)" 선택
3. "변경" 버튼 → 상태 업데이트 ✅

#### Step 4: 배송 처리
1. 다시 "상태 변경" 클릭
2. "배송중 (shipped)" 선택
3. **택배사**: CJ대한통운
4. **송장번호**: 123456789012 (테스트용)
5. "변경" 버튼 → 배송 시작 ✅

---

### 4.3 결제 실패 테스트

#### Step 1: 실패 카드 사용
1. 상품 장바구니 담기
2. "결제하기" 클릭
3. 테스트 실패 카드 입력:
   ```
   카드번호: 1111-1111-1111-1111 (잘못된 카드)
   ```
4. 결제 시도 → 실패 메시지 표시 ✅

#### Step 2: 실패 페이지 확인
1. `/payment/fail` 페이지로 리다이렉트
2. 오류 메시지 확인
3. "장바구니로 돌아가기" 버튼

---

## 5. 테스트 카드 목록

### 성공 카드
| 카드번호 | 결과 |
|---------|------|
| `4242-4242-4242-4242` | ✅ 결제 성공 |
| `5555-5555-5555-4444` | ✅ 결제 성공 (마스터카드) |

### 실패 카드
| 카드번호 | 결과 |
|---------|------|
| `1111-1111-1111-1111` | ❌ 잘못된 카드번호 |
| `4000-0000-0000-0002` | ❌ 잔액 부족 |
| `4000-0000-0000-0069` | ❌ 카드 만료 |

### 공통 정보
- **유효기간**: 현재보다 미래 날짜 (예: `12/25`)
- **CVC**: 아무 3자리 숫자 (예: `123`)
- **비밀번호**: 아무 2자리 숫자 (예: `12`)

---

## 6. 체크리스트

### 결제 플로우
- [ ] 장바구니에 상품 담기
- [ ] 쿠폰 적용 (WELCOME10)
- [ ] 결제하기 버튼 클릭 → 토스 결제창 열림
- [ ] 테스트 카드 입력 (4242-4242-4242-4242)
- [ ] 결제 성공 → `/payment/success` 리다이렉트
- [ ] 주문 번호 표시
- [ ] 주문 내역에 추가 확인

### Admin 관리
- [ ] Admin 대시보드 → 오늘 주문 숫자 증가
- [ ] 주문 관리 페이지 → 새 주문 표시
- [ ] 주문 상태 변경: 결제완료 → 상품준비중
- [ ] 주문 상태 변경: 상품준비중 → 배송중 (송장번호 입력)
- [ ] 주문 상태 변경: 배송중 → 배송완료

### 에러 처리
- [ ] 잘못된 카드번호 → 결제 실패
- [ ] `/payment/fail` 페이지 표시
- [ ] 오류 메시지 확인
- [ ] 장바구니로 돌아가기 동작

---

## 7. 주의사항

### 테스트 모드 제한
- ✅ **실제 금액 청구 없음**: 테스트 키로는 절대 실제 결제 불가
- ✅ **무제한 테스트**: 횟수 제한 없이 자유롭게 테스트
- ✅ **동일한 결제 플로우**: 프로덕션과 100% 동일한 UI/UX

### 프로덕션 전환
1. `.env.local` → `.env.production` 복사
2. 토스페이먼츠 대시보드 → "라이브 모드" 전환
3. 라이브 키 발급 (live_ck_..., live_sk_...)
4. 환경 변수 교체:
   ```bash
   NEXT_PUBLIC_TOSS_CLIENT_KEY=live_ck_xxxxx
   TOSS_SECRET_KEY=live_sk_xxxxx
   ```
5. Vercel 대시보드 → 환경 변수 추가
6. 재배포

---

## 8. 문제 해결

### 결제창이 안 열려요
1. 브라우저 콘솔 확인 (F12)
2. 환경 변수 확인: `NEXT_PUBLIC_TOSS_CLIENT_KEY` 설정 여부
3. npm 패키지 설치 확인: `npm install @tosspayments/payment-sdk`

### 결제 후 주문이 생성 안 돼요
1. Supabase 대시보드 → "Table Editor" → `orders` 테이블 확인
2. 브라우저 네트워크 탭 → `/api/payment/verify` 요청 확인
3. 환경 변수 확인: `TOSS_SECRET_KEY` 설정 여부

### 송장번호 입력이 안 돼요
1. Admin 주문 관리 페이지 새로고침
2. 주문 상태가 "배송중"으로 변경되었는지 확인
3. Supabase 테이블에 `tracking_number`, `shipping_company` 컬럼 존재 확인

---

## 9. 다음 단계

### 현재 구현됨 ✅
- [x] 토스페이먼츠 테스트 모드 연동
- [x] 결제 요청 (장바구니 → 결제창)
- [x] 결제 성공 처리 (주문 생성)
- [x] 결제 실패 처리
- [x] Admin 주문 관리
- [x] 주문 상태 워크플로우
- [x] 송장번호 입력

### 추후 구현 가능 (선택)
- [ ] 웹훅 (결제 상태 자동 동기화)
- [ ] 환불 처리
- [ ] 정기 결제
- [ ] 카카오페이, 네이버페이 추가
- [ ] 이메일 알림 (주문 완료, 배송 시작)

---

## 10. 참고 문서

- [토스페이먼츠 개발 문서](https://developers.tosspayments.com/)
- [결제 테스트 가이드](https://docs.tosspayments.com/guides/test-card)
- [API 레퍼런스](https://docs.tosspayments.com/reference)
- [에러 코드](https://docs.tosspayments.com/reference/error-codes)

---

**작성일**: 2026-01-14  
**작성자**: GenSpark AI Developer  
**버전**: 1.0
